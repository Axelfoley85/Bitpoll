{% extends "base.html" %}

{% load widget_tweaks %}
{% load settings_value %}
{% block title %}Create poll{% endblock %}

{% block content %}
    <section class="section create-poll">
        <div class="container">
            <div class="halfsize">
                <h1>Create a poll</h1>
                <hr/>
                <form method="POST" class="form" action="{% url 'index' %}">
                    <div style="display:none;">
                        {% csrf_token %}
                    </div>
                    <div class="form-step">
                        <div class="number">Step 1</div>
                        <div class="title">Select Type</div>
                    </div>
                    <div class="form-group"><select class="form-control script-hidden" id="create-type-field"
                                                    name="{{ new_Poll.type.name }}">
                        {# TODO dynamisch, inklusive data-values unten #}
                        <option value="datetime" {% if new_Poll.type.value == "datetime" %}selected="selected"{% endif %}>
                            Date and Time
                        </option>
                        <option value="date" {% if new_Poll.type.value == "date" %}selected="selected"{% endif %}>
                            Date
                        </option>
                        <option value="universal" {% if new_Poll.type.value == "universal" %}selected="selected"{% endif %}>
                            Normal Poll
                        </option>
                        <option value="numeric" {% if new_Poll.type.value == "numeric" %}selected="selected"{% endif %}>
                            Numeric
                        </option>
                    </select>
                        <div class="script-only">
                            <ul id="create-type-list" class="type-choices">
                                <li data-value="datetime">
                                    <div class="icon"><i class="fa fa-clock-o"></i>
                                    </div>
                                    <div class="text">
                                        <div class="title">Date and Time</div>
                                        <div class="description">Schedule date and time for an event</div>
                                    </div>
                                </li>
                                <li data-value="date">
                                    <div class="icon"><i class="fa fa-calendar"></i>
                                    </div>
                                    <div class="text">
                                        <div class="title">Date</div>
                                        <div class="description">Schedule an all-day event</div>
                                    </div>
                                </li>
                                <li data-value="universal">
                                    <div class="icon"><i class="fa fa-list"></i>
                                    </div>
                                    <div class="text">
                                        <div class="title">Normal Poll</div>
                                        <div class="description">Retrieve opinions on various choices</div>
                                    </div>
                                </li>
                                <li data-value="numeric">
                                    <div class="icon"><i class="fa fa-sliders"></i>
                                    </div>
                                    <div class="text">
                                        <div class="title">Numeric</div>
                                        <div class="description">Rate each choice in a numeric range</div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="form-step">
                        <div class="number">Step 2</div>
                        <div class="title">Enter Title</div>
                    </div>
                    <div class="form-group">
                        <input autocomplete="off" class="form-control" id="title-input" name="{{ new_Poll.title.name }}"
                                                   placeholder="Title" type="text" value="{{ new_Poll.title.value|default_if_none:'' }}" />
                        {% if new_Poll.title.errors %}
                            <div class="form-errors">
                                <div class="alert alert-danger">
                                    <div class="container">
                                    <i class="fa fa-times"></i>{{ new_Poll.title.errors }}
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                    <div id="advanced-open" class="{% if not new_Poll.url.errors %}hidden{% endif %}">
                        <div class="form-step">
                            <div class="number">Step 3</div>
                            <div class="title">Advanced Settings</div>
                        </div>
                    {# TODO: due date, public? #}
                        <script>var RANDOM_SLUGS = false;</script>
                        <div id="slug" class="form-group">
                            <div style="float: right;">
                                <button id="slug-randomize" class="action small"><i class="fa fa-random"></i><span>Randomize</span>
                                </button>
                            </div>
                            <label for="slug" style="margin-top: 2px;">URL name</label>
                            <div class="input-group"><span class="input-group-addon">http://127.0.0.1:5000/poll/</span>
                                <input class="form-control" id="slug-input" name="{{ new_Poll.url.name }}" type="text" value="{{ new_Poll.url.value }}">
                                {% if new_Poll.url.errors %}
                                    <div class="form-errors">
                                        <div class="alert alert-danger">
                                            <div class="container">
                                            <i class="fa fa-times"></i>{{ new_Poll.url.errors }}
                                            </div>
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="form-group text-center">
                        <a id="advanced-toggle" href="#" class="action">
                            <span class="more"><i class="fa fa-plus-square-o"></i>
                                <span>More options</span>
                            </span>
                            <span class="less hidden"><i class="fa fa-minus-square-o"></i>
                                <span>Less options</span>
                            </span>
                        </a>
                        <input type="submit" value="Create" class="action primary"/>
                    </div>
                </form>
            </div>
        </div>
    </section>
    {% if request.user.is_anonymous %}
    <section class="section login">
        <div class="container">
            <div class="halfsize">
                <form method="POST" action="{% url 'login' %}" class="form">
                    <h1>Log in</h1>
                    <div style="display:none;">
                        {% csrf_token %}
                    </div>
                    <div class="form-group"><label for="username">Username</label><input class="form-control"
                                                                                         id="username" name="username"
                                                                                         type="text" value="">
                    </div>
                    <div class="form-group"><label for="password">Password</label><input class="form-control"
                                                                                         id="password" name="password"
                                                                                         type="password" value="">
                    </div>
                    <div class="form-group">
                        <input type="submit" value="Login" class="pull-right action secondary"/>
                    </div>
                </form>
            </div>
        </div>
    </section>
    {% endif %}
    <div class="container">
        <div class="row padded-cells">
            {% if request.user.is_anonymous %}
            <div class="col-md-4">
                <h4>Register for more</h4>
                <p>Registered users have access to the full width of features available.
                </p>
                <a href="/register" class="action"><i class="fa fa-pencil"></i><span>Register</span></a>
                <a href="/login" class="action primary"><i class="fa fa-sign-in"></i> Login</a>
            </div>
            {% endif %}
        {# TODO: own polls? #}
            <div class="col-md-4">
                <h4>Statistics</h4>
                <table class="table">
                    <tr>
                        <th>Polls created</th>
                        <td>{{ poll_count }}</td>
                    </tr>
                    <tr>
                        <th>Votes cast</th>
                        <td>{{ votes_count }}</td>
                    </tr>
                    <tr>
                        <th>Users</th>
                        <td>{{ user_count }}</td>
                    </tr>
                </table>
            </div>
            <div class="col-md-4">
                <h4>Public polls</h4>
                <div class="alert alert-info">
                    <div class="container"><i class="fa fa-exclamation-circle"></i>There are currently no public polls.
                    </div>
                </div>
            </div>
        </div>
    </div>

{% endblock %}